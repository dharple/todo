#!/bin/sh
#
# See README.md to get --login-path working.
#

DEST=~/backup/todo.sql.gz
WORK=/tmp/todo-$$.sql.gz

mysqldump --login-path=todo-old --opt --skip-extended-insert --no-tablespaces todo | gzip -c - > $WORK

COPY=yes
if [ -f $DEST ] ; then
	zdiff --ignore-matching-lines="Dump completed on" $DEST $WORK
	if [ $? -eq 0 ] ; then
		COPY=no
	fi
fi

if [ "$COPY" = "yes" ] ; then
	cp $WORK $DEST
fi

rm -f $WORK
